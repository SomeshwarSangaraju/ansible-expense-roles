- name: install mysql server
  ansible.builtin.package: 
    name: mysql-server
    state: present

- name: start and enable mysql
  ansible.builtin.service:
    name: mysqld
    state: started
    enabled: yes

- name: setting root password
  ansible.builtin.command: mysql_secure_installation --set-root-pass "{{ MYSQL_ROOT_PASSWORD}}"

- name: Enable MySQL 8.0 module
  dnf_module:
    name: mysql
    stream: 8.0
    state: enabled

- name: Install required dependencies
  dnf:
    name:
      - python3-pip
      - python3-devel
      - mysql-community-devel   # instead of mysql-devel
    state: present

- name: Install MySQL Python library
  pip:
    name: mysqlclient
    executable: pip3


- name: Show list of databases
  community.mysql.mysql_query:
    login_host: "{{ MYSQL_HOST }}"
    login_user: "{{ MYSQL_ROOT_USER }}"
    login_password: "{{ MYSQL_ROOT_PASSWORD }}"
    query: "SHOW DATABASES;"
  register: db_list

- name: Display databases
  ansible.builtin.debug:
    msg: "{{ db_list.query_result[0] }}"

- name: Show tables in selected database
  community.mysql.mysql_query:
    login_host: "{{ MYSQL_HOST }}"
    login_user: "{{ MYSQL_ROOT_USER }}"
    login_password: "{{ MYSQL_ROOT_PASSWORD }}"
    login_db: "{{ MYSQL_DB }}"
    query: "SHOW TABLES;"
  register: table_list

- name: Display tables
  ansible.builtin.debug:
    msg: "{{ table_list.query_result[0] }}"

- name: Show data from selected table
  community.mysql.mysql_query:
    login_host: "{{ MYSQL_HOST }}"
    login_user: "{{ MYSQL_ROOT_USER }}"
    login_password: "{{ MYSQL_ROOT_PASSWORD }}"
    login_db: "{{ MYSQL_DB }}"
    query: "SELECT * FROM {{ MYSQL_TABLE }} LIMIT 10;"
  register: table_data

- name: Display table data (first 10 rows)
  ansible.builtin.debug:
    msg: "{{ table_data.query_result[0] }}"

